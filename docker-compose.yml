version: '3.8'

services:
  # 1. THE COLLATOR (Scorer) - Port 3000
  app:
    container_name: coyote-collator-app
    build:
      context: .
      dockerfile: Dockerfile  # Standard build
    ports:
      - "3000:3000"
    volumes:
      - ./camporee:/app/camporee
      - ./data:/app/data
    restart: unless-stopped

  # 2. THE COMPOSER (Builder) - Port 3001
  composer:
    container_name: coyote-collator-composer
    build:
      context: .
      dockerfile: Dockerfile.composer # Minification build
    ports:
      - "3001:3001"
    volumes:
      # Map the host 'camporee' folder to the container's 'camporees' folder
      - ./camporee:/app/camporees

      # COMMENTED OUT: We do NOT map '.' to '/app' here.
      # If we did, we would overwrite the minified code with our raw source code.
      # - .:/app
    restart: unless-stopped